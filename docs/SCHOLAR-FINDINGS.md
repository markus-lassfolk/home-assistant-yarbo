# Scholar Research Findings

Deep analysis of the Yarbo communication protocol and the current `home-assistant-yarbo` integration has highlighted several gaps in functionality and documentation. This document serves to track the integration roadmap.

## 1. Controller Lock Mechanism
**What's missing from current docs:** The architecture requires acquiring a controller lock before sending most manual commands (like lights, driving, or toggles).
**Source in reversing repo:** `docs/MQTT_PROTOCOL.md` (`get_controller` protocol section).
**Suggested content:** We need to document the requirement to call `get_controller` before sending manual commands, handling the `state: 0` response confirmation, and managing lock expiration timeouts.

## 2. Destructive Commands and State Management
**What's missing from current docs:** Clear warnings and parameter schemas for destructive commands like `erase_map`, `shutdown`, `restore_default_setting`, and `del_all_plan`.
**Source in reversing repo:** `docs/COMMAND_CATALOGUE.md` (Dangerous Commands section).
**Suggested content:** Add a "Warnings" section documenting commands that permanently alter the device state or require physical intervention (like `shutdown`), ensuring they are gated behind HA confirmation dialogues.

## 3. Head-Specific Command Constraints
**What's missing from current docs:** The protocol behaves differently based on the installed head (e.g., snow blower vs leaf blower).
**Source in reversing repo:** `docs/MQTT_PROTOCOL.md` (Head-Specific Commands section).
**Suggested content:** Document that commands like `cmd_roller` and `blower_speed` will be silently ignored if the incorrect head is attached or if the head is not actively running.

## 4. OTA Firmware and System State
**What's missing from current docs:** Details on triggering and monitoring OTA updates, and restarting software containers.
**Source in reversing repo:** `docs/MQTT_PROTOCOL.md` (OTA Updates and Hardware/System sections).
**Suggested content:** Document the use of `firmware_update_now`, `restart_container`, and the subscription to `ota_feedback` for tracking update progress.

## 5. Vision and Sensor Toggles
**What's missing from current docs:** The device exposes granular control over its vision systems (camera, laser, smart vision, person detection).
**Source in reversing repo:** `docs/COMMAND_CATALOGUE.md` (Vision / Sensors section).
**Suggested content:** Provide schemas for toggling these features via `{"enabled": bool}` and document the required payload structure for `set_person_detect`.

## 6. Zlib Payload Compression
**What's missing from current docs:** Explicit handling documentation for zlib-compressed payloads on specific topics.
**Source in reversing repo:** `docs/MQTT_PROTOCOL.md` (Response Envelope Format).
**Suggested content:** Document that all app-to-robot commands via the `/app/<cmd_name>` topics must be zlib-compressed JSON, and all feedback on `device/data_feedback` will be returned compressed.

---
*Generated by Scholar (Research Agent)*
